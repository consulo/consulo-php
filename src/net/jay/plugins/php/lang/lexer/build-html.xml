<!-- Use this build only with idea-flex.skeleton and with patched JFlex.jar -->
<project name="Generate structuring lexer from flex files" default="dist">
	<property name="jflex.dir" value="../../../../../../../lib/jflex"/>

	<property name="lexer.dir" value="."/>
	<property name="lexer.file" value="${lexer.dir}/PHPStructuringFlexLexer.java"/>
	<property name="lexer.log" value="${lexer.dir}/struct.log"/>
	<property name="lexer.source" value="${lexer.dir}/PHPStructuringFlexLexer.flex"/>
	<property name="lexer.skeleton" value="${jflex.dir}/idea-flex.skeleton"/>
	<property name="compiler.max.memory" value="256m"/>
	<property name="jflex.file" value="${jflex.dir}/lib/JFlex.jar"/>

	<target name="clean">
		<delete file="${lexer.file}~"/>
		<delete file="${lexer.file}"/>
		<delete file="${lexer.log}"/>
	</target>

	<target name="jflex" description="Produces Jflex based lexer" depends="clean">
		<java jar="${jflex.file}" output="${lexer.log}" fork="true" maxmemory="${compiler.max.memory}">
			<arg value="--charat"/>
			<arg value="-skel"/>
			<arg value="${lexer.skeleton}"/>
			<arg value="${lexer.source}"/>
		</java>
	</target>

	<target name="dist" depends="clean, jflex" description="main target"/>

</project>
